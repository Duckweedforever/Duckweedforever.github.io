(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{614:function(n,s,a){"use strict";a.r(s);var e=a(5),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"什么是qiankun"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是qiankun"}},[n._v("#")]),n._v(" 什么是qiankun")]),n._v(" "),a("p",[a("a",{attrs:{href:"https://qiankun.umijs.org/zh/guide",target:"_blank",rel:"noopener noreferrer"}},[n._v("Qiankun"),a("OutboundLink")],1),n._v("：基于Single-Spa，阿里系开源微前端框架。具有以下特点：\n简单——任意 js 框架均可使用。微应用接入像使用接入一个 iframe 系统一样简单，但实际不是 iframe。\n完备——几乎包含所有构建微前端系统时所需要的基本能力，如 样式隔离、js 沙箱、预加载等。\n生产可用——已在蚂蚁内外经受过足够大量的线上系统的考验及打磨，健壮性值得信赖。\n构建基础应用")]),n._v(" "),a("h1",{attrs:{id:"构建基础应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建基础应用"}},[n._v("#")]),n._v(" 构建基础应用")]),n._v(" "),a("p",[n._v("今天我们将会使用Vue项目作为基座，来联合Vue和React的两个子应用来构建一个微前端架构体系。为方便大家理解，下面我整理了架构图：\n"),a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/06a64dfefbd7460bbb7a8e3a05bac9cb~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?",alt:""}}),n._v("\n需要构建的三个应用分别是Vue主应用(qk-base)、Vue子应用(qk-vue)、React子应用(qk-react)。")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// Vue主应用(基座)\nvue create qk-base\n// Vue子应用\nvue create qk-vue\n// react子应用\nnpx create react-app qk-react\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("p",[n._v("创建完成后文件夹中就会有以下三个项目：\n"),a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71ec60dfa0314fba8f9121bae0be7524~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?",alt:""}})]),n._v(" "),a("h1",{attrs:{id:"主应用-基座-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主应用-基座-配置"}},[n._v("#")]),n._v(" 主应用(基座)配置")]),n._v(" "),a("h2",{attrs:{id:"菜单和样式配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#菜单和样式配置"}},[n._v("#")]),n._v(" 菜单和样式配置")]),n._v(" "),a("p",[n._v("为更方便展示应用的切换我们对主应用的首页进行配置，使用element-ui的菜单对其进行优化展示。使其可以通过切换来显示不同的应用信息。")]),n._v(" "),a("p",[n._v("安装elementUi")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("npm i element-ui -S\n\n// main.js\nimport ElementUI from 'element-ui';\nimport 'element-ui/lib/theme-chalk/index.css';\nVue.use(ElementUI);\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br")])]),a("p",[n._v("App.vue")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('<el-menu :router="true" class="el-menu-demo" mode="horizontal" >\n  <el-menu-item index="/">主应用页面</el-menu-item>\n  <el-menu-item index="/vue">Vue应用</el-menu-item>\n  <el-menu-item index="/react">react应用</el-menu-item>\n</el-menu>\n    <router-view></router-view>\n    \x3c!-- 加载VUE子应用 --\x3e\n    <div id="vue"></div>\n    \x3c!-- 加载React子应用 --\x3e\n    <div id="react"></div>\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br")])]),a("p",[n._v("在这里，我们设定Vue子引用的路径开头为'/vue',React子应用的开头为'/react'。并使用id=\"vue\"和id=\"react\"两个div来接收他们。")]),n._v(" "),a("p",[n._v("值得一提的是，主应用的路由也可以通过router-view来进行路由切换。\n"),a("a",{attrs:{href:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b0c92da2b5a84752b216667d21a535c8~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?",target:"_blank",rel:"noopener noreferrer"}},[a("OutboundLink")],1),n._v("\n安装qiankun")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("yarn add qiankun # 或者 npm i qiankun -S\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("p",[n._v("引入qiankun")]),n._v(" "),a("p",[n._v("main.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("import { registerMicroApps, start } from 'qiankun';\n// ...\nlet apps = [\n  {\n    name: 'vue faxian', // 子应用名称\n    entry: '//localhost:10000', // 默认会加载这个html解析里面的js动态的执行，因为请求了资源子应用需要支持跨域\n    container: '#vue', // 挂在到那个节点上\n    activeRule: '/vue', // 访问某个URL的时候将这个端口号挂在到这个上去\n  },\n  {\n    name: 'react exam', \n    entry: '//localhost:20000',\n    container: '#react',\n    activeRule: '/react',\n  },\n];\nregisterMicroApps(apps); // 注册应用\nstart({\n  prefetch: false // 取消预加载 \n}); // 开启\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br")])]),a("h1",{attrs:{id:"子应用vue配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#子应用vue配置"}},[n._v("#")]),n._v(" 子应用Vue配置")]),n._v(" "),a("p",[n._v("在子应用中必须要三个函数(必须是promise的)：bootstrap()、mount()、unmount()。我们这里使用async函数将其导出。")]),n._v(" "),a("p",[n._v("main.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('// 子组件协议\n/**\n * 启动时\n *\n */\nexport async function bootstrap(){}\n/**\n * 创建时\n * @param {*} props 父应用传过来的数据\n */\nexport async function mount(props){\n  render(props)\n}\n/**\n * 卸载时\n */\nexport async function unmount(){\n  instance.$destroy();\n  instance.$el.innerHTML = "";\n  instance = null;\n}\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br")])]),a("p",[n._v("我们需要更新子应用路由的一些配置，包括设置根目录和调为history模式：")]),n._v(" "),a("p",[n._v("router/index.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// your router config ...\n\nconst router = new VueRouter({\n    mode: 'history', // 设置路由模式为history\n    base:'/vue', // 设置根目录为 /vue\n    routes\n})\nexport default router;\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br")])]),a("p",[n._v("设置创建vue实例的方法 render(),这里是挂载到自己的html中，基座会拿到这个挂载后的html将其插入进去。")]),n._v(" "),a("p",[n._v("main.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("function render(){\n  instance = new Vue({\n    router,\n    // store // 也可以传递父应用的vuex\n    render: h => h(App),\n  }).$mount('#app') // 这里是挂载到自己的html中，.基座会拿到这个挂载后的html将其插入进去\n}\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("p",[n._v("当然我们需要独立运行时也能正常运行，qiankun提供一个参数__POWERED_BY_QIANKUN__来判断是不是在独立运行：")]),n._v(" "),a("p",[n._v("main.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 使用 webpack 运行时 publicPath 配置\nif(window.__POWERED_BY_QIANKUN__){ // 动态添加public_path\n  // eslint-disable-next-line no-undef\n  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;\n}\n// 独立运行微应用\nif (!window.__POWERED_BY_QIANKUN__) { // 默认独立运行\n  render();\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br")])]),a("p",[n._v("最后我们配置上打包就可以了。")]),n._v(" "),a("p",[n._v("vue.config.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("module.exports = {\n    devServer:{\n        port:10000, // 启用10000端口来监听\n        headers:{\n            'Access-Control-Allow-origin':'*' // 配置本地运行时允许跨域\n        }\n    },\n    configureWebpack:{\n        output:{\n            library: 'vueApp', \n            libraryTarget: 'umd'\n        }\n    }\n}\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br")])]),a("p",[n._v("运行后的结果：\n"),a("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e907dbfb6af645ff9b63955c6c17ecd6~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?",alt:""}})]),n._v(" "),a("h1",{attrs:{id:"数据通信"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据通信"}},[n._v("#")]),n._v(" 数据通信")]),n._v(" "),a("p",[n._v("比方说我们现在需要将主应用的用户信息同步到子应用中。")]),n._v(" "),a("p",[n._v("我们可以通过配置主应用的main.js来传递参数，当然这里可以以是vuex或者redux\n"),a("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/04bb2a5f744c405aa02632b5b7714d43~tplv-k3u1fbpfcp-zoom-in-crop-mark:1304:0:0:0.awebp?",alt:""}})]),n._v(" "),a("p",[n._v("在子应用的mount方法中去接收这个参数")]),n._v(" "),a("p",[n._v("qk-vue main.js")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("export async function mount(props){\n  if(props?.userInfo){\n    console.log(props.userInfo)\n    // 设置主应用过来的参数\n    window.sessionStorage.setItem('userInfo',props.userInfo);\n  }\n  render(props)\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7051168103169785869",target:"_blank",rel:"noopener noreferrer"}},[n._v("原文地址"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=t.exports}}]);